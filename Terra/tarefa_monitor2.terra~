#include "/home/terra/TerraNet_v0.1/terra/TerraNet.defs"

var ushort nodeId = getNodeId();

pktype usrMsg from radioMsg with
	var ubyte[4] d8;
	var ushort[4] d16;
	var ulong[2] d32;
end

var ubyte stat;
var usrMsg msgRadio, msgEnvio, msgReceber;
msgRadio.d16[0] = 0;
//msgRadio.source = nodeId;

par do
	loop do
		await 5s;
		var short seila = nodeId%10;
		emit REQ_TEMP();
		await (seila)s;
		msgRadio.d16[0] = await TEMP;
		stat = qPut(msgRadio);
	end
with
	loop do
		await Q_READY;
		stat = qGet(msgEnvio);
		if nodeId != 11 then
			msgEnvio.target = nodeId - 1;
		else
			msgEnvio.target = 1;
		end
		emit SEND(msgEnvio);
		await SEND_DONE;
	end 
with
	loop do
 		msgReceber = await RECEIVE;
		stat = qPut(msgReceber);
	end
end
